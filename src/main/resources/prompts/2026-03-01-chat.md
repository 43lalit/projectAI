# ProjectAI Chat Notes - 2026-03-01

## Summary
This session focused on production polish across discovery/search UX, favorites behavior, dark mode readability, item-type semantics, recent-history (phase 1 + phase 2), and a major MDRM profile redesign with timeline/change analysis and D3 relationship visualization.

## Work Completed
- Added item type code-to-value translation for display/query surfaces:
  - `J` Projected
  - `D` Derived
  - `F` Financial/reported
  - `R` Rate
  - `S` Structure
  - `E` Examination/supervision
  - `P` Percentage
- Added `MDRM Type` column in Discovery AG Grid.
- Added and refined favorites behavior in Discovery:
  - favorites-first initial ordering
  - sortable `Favorite` column
  - improved star behavior across cards/results
- Dark mode fixes for readability:
  - stronger table text/stripe/hover contrast
  - run-metrics grid visibility corrected in dark mode
- Header/nav consistency updates:
  - icon-based colorful menu style
  - propagated across pages
  - removed separate MDRM top menu entry
- Added Recent Items (max 10) as quick-access cards:
  - cards for report/mdrm with icons
  - bookmark star per recent card (empty vs gold)
  - clear action support
- Implemented Recent Items Phase 2 backend persistence:
  - per-user server store with fallback to local cache
  - API endpoints:
    - `GET /api/recent/items?limit=10`
    - `POST /api/recent/items?limit=10`
    - `DELETE /api/recent/items`
- UX refinements after review:
  - moved Recent Items as a separate panel above Search & Discovery
  - removed unnecessary pre-search guidance text
  - clear action and bookmark integration improved on cards
- MDRM profile backend and UI implementation:
  - Added profile endpoint:
    - `GET /api/mdrm/profile?mdrm=<code>`
  - Added profile payload models for:
    - timeline
    - associations
    - related MDRMs/reports
    - first-vs-latest field change list
    - per-run timeline field change list
  - Implemented robust `item_type` resolution fallback:
    - latest MDRM row
    - latest non-blank MDRM row
    - latest non-blank same `item_code` family row
    - supports alternate source columns (`item_type`, `item_type_cd`, `itemtype`, `mdrm_type`, `type`)
  - Added normalization for numeric `item_code` matching (leading-zero safe).
- MDRM profile timeline upgrades:
  - Replaced plain timeline table with visual timeline cards
  - Added run-over-run changed-field detection
  - Added first-vs-latest field delta block
  - Added collapsible per-run details showing previous/current value per changed field
  - Added change/no-change color coding and `No Change` labeling
- Related entity UX redesign:
  - Replaced separate related reports view with a unified relationship approach
  - Introduced D3 concentric graph in `Related MDRM Graph` tab:
    - center: selected MDRM
    - ring 1: reports
    - ring 2: related MDRMs
  - Added right-side detail panel updated on node click:
    - center node: selected MDRM summary
    - report node: associated MDRM list with status/type
    - MDRM node: code/report/status/type
  - Added graph filter toggle:
    - default: active-only nodes
    - optional: include inactive
- Header/auth/nav consistency:
  - MDRM page now uses consistent auth dropdown behavior (login/sign up/reset/logout).
  - Discovery-to-profile navigation now preserves search context and supports back navigation to prior results.
- Status visualization:
  - Added reusable status capsules:
    - Active (green)
    - Inactive (red)
  - Applied across MDRM/profile/reporting status surfaces.

## New Backend Components
- `src/main/java/com/projectai/projectai/recent/RecentController.java`
- `src/main/java/com/projectai/projectai/recent/RecentService.java`
- `src/main/java/com/projectai/projectai/recent/RecentModels.java`
- `src/main/java/com/projectai/projectai/mdrm/MdrmProfileResponse.java`
- `src/main/java/com/projectai/projectai/mdrm/MdrmProfileTimelineEntry.java`
- `src/main/java/com/projectai/projectai/mdrm/MdrmProfileTimelineFieldChange.java`
- `src/main/java/com/projectai/projectai/mdrm/MdrmProfileFieldChange.java`
- `src/main/java/com/projectai/projectai/mdrm/MdrmProfileAssociation.java`
- `src/main/java/com/projectai/projectai/mdrm/MdrmProfileRelatedMdrm.java`
- `src/main/java/com/projectai/projectai/mdrm/MdrmProfileRelatedReport.java`

## Notes
- Recent items now prioritize usability:
  - visible at landing top area
  - not pushed below large result sets
  - local fallback maintained for resilience
- MDRM profile has become the dedicated deep-dive experience while discovery remains the landing/search workspace.
